<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MyBatis的缓存 | Coding Ayoung</title>
    <meta name="generator" content="VuePress 1.9.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.0aa1cacf.css" as="style"><link rel="preload" href="/assets/js/app.4cfa5f3c.js" as="script"><link rel="preload" href="/assets/js/2.05af1349.js" as="script"><link rel="preload" href="/assets/js/44.065a74e8.js" as="script"><link rel="prefetch" href="/assets/js/10.66567ee0.js"><link rel="prefetch" href="/assets/js/11.1f4f4ed4.js"><link rel="prefetch" href="/assets/js/12.06422b58.js"><link rel="prefetch" href="/assets/js/13.899800b9.js"><link rel="prefetch" href="/assets/js/14.ea3c8e17.js"><link rel="prefetch" href="/assets/js/15.b01969f3.js"><link rel="prefetch" href="/assets/js/16.c97582ef.js"><link rel="prefetch" href="/assets/js/17.c87f5dfc.js"><link rel="prefetch" href="/assets/js/18.7d72f6be.js"><link rel="prefetch" href="/assets/js/19.b755ee6c.js"><link rel="prefetch" href="/assets/js/20.1014aa6e.js"><link rel="prefetch" href="/assets/js/21.f0529276.js"><link rel="prefetch" href="/assets/js/22.1bb9495b.js"><link rel="prefetch" href="/assets/js/23.b6fa9bcc.js"><link rel="prefetch" href="/assets/js/24.09e27301.js"><link rel="prefetch" href="/assets/js/25.546b2725.js"><link rel="prefetch" href="/assets/js/26.61e25f70.js"><link rel="prefetch" href="/assets/js/27.0fa49e95.js"><link rel="prefetch" href="/assets/js/28.f8a97284.js"><link rel="prefetch" href="/assets/js/29.7542b5d3.js"><link rel="prefetch" href="/assets/js/3.3d227a19.js"><link rel="prefetch" href="/assets/js/30.74cc9197.js"><link rel="prefetch" href="/assets/js/31.8051867b.js"><link rel="prefetch" href="/assets/js/32.eff265cc.js"><link rel="prefetch" href="/assets/js/33.ece5d882.js"><link rel="prefetch" href="/assets/js/34.c1f79bbc.js"><link rel="prefetch" href="/assets/js/35.aff5fde4.js"><link rel="prefetch" href="/assets/js/36.49b3c8ba.js"><link rel="prefetch" href="/assets/js/37.3cc2d286.js"><link rel="prefetch" href="/assets/js/38.b1fb1852.js"><link rel="prefetch" href="/assets/js/39.cc1653e3.js"><link rel="prefetch" href="/assets/js/4.855f1166.js"><link rel="prefetch" href="/assets/js/40.0b0f1f98.js"><link rel="prefetch" href="/assets/js/41.57cc6dc4.js"><link rel="prefetch" href="/assets/js/42.84ab8021.js"><link rel="prefetch" href="/assets/js/43.3cc05505.js"><link rel="prefetch" href="/assets/js/45.1de9c020.js"><link rel="prefetch" href="/assets/js/46.7da1b5f4.js"><link rel="prefetch" href="/assets/js/47.25a680e9.js"><link rel="prefetch" href="/assets/js/48.db8a55d4.js"><link rel="prefetch" href="/assets/js/5.c3e49c8d.js"><link rel="prefetch" href="/assets/js/6.251782bc.js"><link rel="prefetch" href="/assets/js/7.01608d28.js"><link rel="prefetch" href="/assets/js/8.6d6ae631.js"><link rel="prefetch" href="/assets/js/9.52b37655.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0aa1cacf.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Coding Ayoung</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/computerbasics/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/datastructrue/001/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/computerinternet/001/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operatingsystem/001/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/markdown/001/" class="nav-link">Markdown</a></li><li class="dropdown-item"><!----> <a href="/git/001/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><a href="/leetcode/001/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basis/001/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/high/001/" class="nav-link">高级</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><a href="/javaweb/" class="link-title">JavaWeb</a> <span class="title" style="display:none;">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/001/" class="nav-link">基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/001/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/001/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/springmvc/001/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/springboot/001/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/mybatis/001/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/mybatis-plus/001/" class="nav-link">MyBatis-Plus</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/computerbasics/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/datastructrue/001/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/computerinternet/001/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operatingsystem/001/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/markdown/001/" class="nav-link">Markdown</a></li><li class="dropdown-item"><!----> <a href="/git/001/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><a href="/leetcode/001/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basis/001/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/high/001/" class="nav-link">高级</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><a href="/javaweb/" class="link-title">JavaWeb</a> <span class="title" style="display:none;">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/001/" class="nav-link">基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/001/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/001/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/springmvc/001/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/springboot/001/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/mybatis/001/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/mybatis-plus/001/" class="nav-link">MyBatis-Plus</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MyBatis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mybatis/001/" class="sidebar-link">简介及配置</a></li><li><a href="/mybatis/002/" class="sidebar-link">核心配置文件详解</a></li><li><a href="/mybatis/003/" class="sidebar-link">MyBatis的各种查询功能</a></li><li><a href="/mybatis/004/" class="sidebar-link">自定义映射resultMap</a></li><li><a href="/mybatis/005/" class="sidebar-link">动态SQL</a></li><li><a href="/mybatis/006/" aria-current="page" class="active sidebar-link">MyBatis的缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/mybatis/006/#mybatis的一级缓存" class="sidebar-link">MyBatis的一级缓存</a></li><li class="sidebar-sub-header level2"><a href="/mybatis/006/#mybatis的二级缓存" class="sidebar-link">MyBatis的二级缓存</a></li><li class="sidebar-sub-header level2"><a href="/mybatis/006/#二级缓存的相关配置" class="sidebar-link">二级缓存的相关配置</a></li><li class="sidebar-sub-header level2"><a href="/mybatis/006/#mybatis缓存查询的顺序" class="sidebar-link">MyBatis缓存查询的顺序</a></li><li class="sidebar-sub-header level2"><a href="/mybatis/006/#整合第三方缓存ehcache-了解" class="sidebar-link">整合第三方缓存EHCache（了解）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/mybatis/006/#添加依赖" class="sidebar-link">添加依赖</a></li><li class="sidebar-sub-header level3"><a href="/mybatis/006/#各个jar包的功能" class="sidebar-link">各个jar包的功能</a></li><li class="sidebar-sub-header level3"><a href="/mybatis/006/#创建ehcache的配置文件ehcache-xml" class="sidebar-link">创建EHCache的配置文件ehcache.xml</a></li><li class="sidebar-sub-header level3"><a href="/mybatis/006/#设置二级缓存的类型" class="sidebar-link">设置二级缓存的类型</a></li><li class="sidebar-sub-header level3"><a href="/mybatis/006/#加入logback日志" class="sidebar-link">加入logback日志</a></li><li class="sidebar-sub-header level3"><a href="/mybatis/006/#ehcache配置文件说明" class="sidebar-link">EHCache配置文件说明</a></li></ul></li></ul></li><li><a href="/mybatis/007/" class="sidebar-link">MyBatis的逆向工程</a></li><li><a href="/mybatis/008/" class="sidebar-link">分页插件</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/framework/#框架" data-v-1baff76c>框架</a></li><li data-v-1baff76c><a href="/framework/#MyBatis" data-v-1baff76c>MyBatis</a></li></ul> <div class="info" data-v-1baff76c><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-03-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">MyBatis的缓存<!----></h1> <div class="page-slot page-slot-top">
  <div class="wwads-cn wwads-horizontal page-ad" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .page-ad img{
      width:70px!important;
    }
    .wwads-horizontal .wwads-content{
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{
      line-height:1;
      flex: 1;
      height: 100%;
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-poweredby, .wwads-vertical .wwads-poweredby{display: none;!important;}
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="mybatis的缓存-缓存只针对查询"><a href="#mybatis的缓存-缓存只针对查询" class="header-anchor">#</a> MyBatis的缓存（缓存只针对查询）</h1> <h2 id="mybatis的一级缓存"><a href="#mybatis的一级缓存" class="header-anchor">#</a> MyBatis的一级缓存</h2> <ul><li><p>一级缓存是SqlSession级别的，通过同一个SqlSession查询的数据会被缓存，下次查询相同的数据，就会从缓存中直接获取，不会从数据库重新访问</p></li> <li><p>使一级缓存失效的四种情况：</p> <ol><li>不同的SqlSession对应不同的一级缓存</li> <li>同一个SqlSession但是查询条件不同</li> <li>同一个SqlSession两次查询期间执行了任何一次增删改操作</li> <li>同一个SqlSession两次查询期间手动清空了缓存</li></ol></li></ul> <h2 id="mybatis的二级缓存"><a href="#mybatis的二级缓存" class="header-anchor">#</a> MyBatis的二级缓存</h2> <ul><li><p>二级缓存是SqlSessionFactory（工厂）级别，通过同一个SqlSessionFactory创建的SqlSession查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取</p></li> <li><p>二级缓存开启的条件</p> <ol><li>在核心配置文件中，设置全局配置属性cacheEnabled=&quot;true&quot;，默认为true，不需要设置</li> <li>在映射文件中设置标签<cache></cache></li> <li>二级缓存必须在SqlSession关闭或提交之后有效(其他通过SqlSessionFactory创建的SqlSession关闭，另外一个通过该SqlSessionFactory建立的sqlsession会从缓存中访问)</li> <li>查询的数据所转换的实体类类型必须实现序列化的接口</li></ol></li> <li><p>使二级缓存失效的情况：两次查询之间执行了任意的增删改，会使一级和二级缓存同时失效</p></li></ul> <h2 id="二级缓存的相关配置"><a href="#二级缓存的相关配置" class="header-anchor">#</a> 二级缓存的相关配置</h2> <ul><li>在mapper配置文件中添加的cache标签可以设置一些属性</li> <li>eviction属性：缓存回收策略
<ul><li>LRU（Least Recently Used） – 最近最少使用的：移除最长时间不被使用的对象。</li> <li>FIFO（First in First out） – 先进先出：按对象进入缓存的顺序来移除它们。</li> <li>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</li> <li>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li> <li>默认的是 LRU</li></ul></li> <li>flushInterval属性：刷新间隔，单位毫秒
<ul><li>默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句（增删改）时刷新</li></ul></li> <li>size属性：引用数目，正整数
<ul><li>代表缓存最多可以存储多少个对象，太大容易导致内存溢出</li></ul></li> <li>readOnly属性：只读，true/false
<ul><li>true：只读缓存；会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。</li> <li>false：读写缓存；会返回缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是false，因为返回的时拷贝的，所以对原始缓存不影响。</li></ul></li></ul> <h2 id="mybatis缓存查询的顺序"><a href="#mybatis缓存查询的顺序" class="header-anchor">#</a> MyBatis缓存查询的顺序</h2> <ul><li>先查询二级缓存，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用</li> <li>如果二级缓存没有命中，再查询一级缓存</li> <li>如果一级缓存也没有命中，则查询数据库</li> <li>SqlSession关闭之后，一级缓存中的数据会写入二级缓存</li></ul> <h2 id="整合第三方缓存ehcache-了解"><a href="#整合第三方缓存ehcache-了解" class="header-anchor">#</a> 整合第三方缓存EHCache（了解）</h2> <h3 id="添加依赖"><a href="#添加依赖" class="header-anchor">#</a> 添加依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- Mybatis EHCache整合包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.caches<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- slf4j日志门面的一个具体实现 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="各个jar包的功能"><a href="#各个jar包的功能" class="header-anchor">#</a> 各个jar包的功能</h3> <table><thead><tr><th>jar包名称</th> <th>作用</th></tr></thead> <tbody><tr><td>mybatis-ehcache</td> <td>Mybatis和EHCache的整合包</td></tr> <tr><td>ehcache</td> <td>EHCache核心包</td></tr> <tr><td>slf4j-api</td> <td>SLF4J日志门面包</td></tr> <tr><td>logback-classic</td> <td>支持SLF4J门面接口的一个具体实现</td></tr></tbody></table> <h3 id="创建ehcache的配置文件ehcache-xml"><a href="#创建ehcache的配置文件ehcache-xml" class="header-anchor">#</a> 创建EHCache的配置文件ehcache.xml</h3> <ul><li>名字必须叫<code>ehcache.xml</code></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../config/ehcache.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 缓存磁盘保存路径 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>D:\atguigu\ehcache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>
            <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">maxElementsOnDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000000<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">diskExpiryThreadIntervalSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LRU<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="设置二级缓存的类型"><a href="#设置二级缓存的类型" class="header-anchor">#</a> 设置二级缓存的类型</h3> <ul><li>在xxxMapper.xml文件中设置二级缓存类型</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.caches.ehcache.EhcacheCache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="加入logback日志"><a href="#加入logback日志" class="header-anchor">#</a> 加入logback日志</h3> <ul><li>存在SLF4J时，作为简易日志的log4j将失效，此时我们需要借助SLF4J的具体实现logback来打印日志。创建logback的配置文件<code>logback.xml</code>，名字固定，不可改变</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">debug</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定日志输出的位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 日志输出的格式 --&gt;</span>
            <span class="token comment">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>[%d{HH:mm:ss.SSS}] [%-5level] [%thread] [%logger] [%msg]%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：DEBUG、INFO、WARN、ERROR --&gt;</span>
    <span class="token comment">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 根据特殊需求指定局部日志级别 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.crowd.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="ehcache配置文件说明"><a href="#ehcache配置文件说明" class="header-anchor">#</a> EHCache配置文件说明</h3> <table><thead><tr><th>属性名</th> <th>是否必须</th> <th>作用</th></tr></thead> <tbody><tr><td>maxElementsInMemory</td> <td>是</td> <td>在内存中缓存的element的最大数目</td></tr> <tr><td>maxElementsOnDisk</td> <td>是</td> <td>在磁盘上缓存的element的最大数目，若是0表示无穷大</td></tr> <tr><td>eternal</td> <td>是</td> <td>设定缓存的elements是否永远不过期。 如果为true，则缓存的数据始终有效， 如果为false那么还要根据timeToIdleSeconds、timeToLiveSeconds判断</td></tr> <tr><td>overflowToDisk</td> <td>是</td> <td>设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</td></tr> <tr><td>timeToIdleSeconds</td> <td>否</td> <td>当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时， 这些数据便会删除，默认值是0,也就是可闲置时间无穷大</td></tr> <tr><td>timeToLiveSeconds</td> <td>否</td> <td>缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</td></tr> <tr><td>diskSpoolBufferSizeMB</td> <td>否</td> <td>DiskStore(磁盘缓存)的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区</td></tr> <tr><td>diskPersistent</td> <td>否</td> <td>在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false</td></tr> <tr><td>diskExpiryThreadIntervalSeconds</td> <td>否</td> <td>磁盘缓存的清理线程运行间隔，默认是120秒。每个120s， 相应的线程会进行一次EhCache中数据的清理工作</td></tr> <tr><td>memoryStoreEvictionPolicy</td> <td>否</td> <td>当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。 默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出</td></tr></tbody></table></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/mybatis/005/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">动态SQL</div></a> <a href="/mybatis/007/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MyBatis的逆向工程</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mybatis/005/" class="prev">动态SQL</a></span> <span class="next"><a href="/mybatis/007/">MyBatis的逆向工程</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="本主页部分内容来自网络，侵权请联系1548362125@qq.com删除。" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>Evan Xu | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4cfa5f3c.js" defer></script><script src="/assets/js/2.05af1349.js" defer></script><script src="/assets/js/44.065a74e8.js" defer></script>
  </body>
</html>
